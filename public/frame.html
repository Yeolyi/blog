<!doctype html>
<html>
  <head>
    <script type="module">
      import stringifyObject from 'https://cdn.jsdelivr.net/npm/stringify-object@5.0.0/+esm';

      const stringify = (x) => {
        return stringifyObject(x, { indent: '  ', inlineCharacterLimit: 80 });
      };

      window.addEventListener('message', (e) => {
        const mainWindow = e.source;
        console.log = (...data) =>
          mainWindow.postMessage(
            {
              type: 'log',
              data: data.map((x) => stringify(x)).join(', '),
            },
            '*',
          );
        try {
          (0, eval)(e.data);
        } catch (e) {
          mainWindow.postMessage({ type: 'exception', data: e.message }, '*');
        }
      });
    </script>
  </head>
</html>
