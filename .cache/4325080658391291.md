
[MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)

**Cross-Origin Resource Sharing** (CORS) is an HTTP-header based mechanism that allows a server to indicate any origins (domain, scheme, or port) other than its own from which a browser should permit loading resources.

CORS also relies on a mechanism by which browsers make a **"preflight"** request to the server hosting the cross-origin resource, in order to check that the server will permit the actual request.

## What requests use CORS?

- Invocations of the XMLHttpRequest or Fetch APIs, as discussed above.
- Web Fonts (for cross-domain font usage in @font-face within CSS), so that servers can deploy TrueType fonts that can only be loaded cross-origin and used by websites that are permitted to do so.
- WebGL textures.
- Images/video frames drawn to a canvas using drawImage().
- CSS Shapes from images.

## Functional overview

The Cross-Origin Resource Sharing standard works by adding **new HTTP headers** that let servers describe which origins are permitted to read that information from a web browser.

Additionally, for HTTP request methods that can cause side-effects on server data (in particular, HTTP methods other than GET, or POST with certain MIME types), the specification mandates that browsers **"preflight"** the request, soliciting supported methods from the server with the HTTP OPTIONS request method, and then, upon "approval" from the server, sending the actual request.

Servers can also inform clients whether **"credentials"** (such as Cookies and HTTP Authentication) should be sent with requests.

## Examples of access control scenarios

### Simple requests

Some requests don't trigger a CORS preflight. Those are called simple requests.

Suppose web content at `https://foo.example` wishes to invoke content on domain`https://bar.other`.

```js
const xhr = new XMLHttpRequest();
const url = 'https://bar.other/resources/public-data/';

xhr.open('GET', url);
xhr.onreadystatechange = someHandler;
xhr.send();
```

Browser:

```http

GET /resources/public-data/ HTTP/1.1
Host: bar.other
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Connection: keep-alive
Origin: https://foo.example
```

Server:

```http
HTTP/1.1 200 OK
Date: Mon, 01 Dec 2008 00:23:53 GMT
Server: Apache/2
Access-Control-Allow-Origin: *
Keep-Alive: timeout=2, max=100
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: application/xml

[…XML Data…]
```

Access-Control-Allow-Origin: \* means that the resource can be accessed by any origin.

### Preflighed requests

Unlike simple requests, for "preflighted" requests the browser first sends an HTTP request using the OPTIONS method to the resource on the other origin, in order to determine if the actual request is safe to send.

[What's to stop malicious code from spoofing the "Origin" header to exploit CORS?](https://stackoverflow.com/questions/21058183/whats-to-stop-malicious-code-from-spoofing-the-origin-header-to-exploit-cors)

**OPTIONS** is an HTTP/1.1 method that is used to determine further information from servers, and is a safe method, meaning that it can't be used to change the resource.

```http
Access-Control-Allow-Origin: https://foo.example
Access-Control-Allow-Methods: POST, GET, OPTIONS
Access-Control-Allow-Headers: X-PINGOTHER, Content-Type
Access-Control-Max-Age: 86400
```

Access-Control-Max-Age gives the value in seconds for how long the response to the preflight request can be cached without sending another preflight request.

### Preflighted requests and redirects

Not all browsers currently support following redirects after a preflighted request.

### Request with credentials

The most interesting capability exposed by both XMLHttpRequest or Fetch and CORS is the ability to make "credentialed" requests that are aware of HTTP cookies and HTTP Authentication information. By default, in cross-origin XMLHttpRequest or Fetch invocations, browsers will **not** send credentials.

### Preflight requests and credentials

CORS-preflight requests must never include credentials.

## The HTTP response headers

- Access-Control-Allow-Origin
- Access-Control-Expose-Headers
- Access-Control-Max-Age
- Access-Control-Allow-Credentials
- Access-Control-Allow-Methods
- Access-Control-Allow-Headers

## The HTTP request headers

- Origin
- Access-Control-Request-Method
- Access-Control-Request-Headers

## ...

```js
const express = require('express');
const app = express();

// Enable CORS middleware
app.use(function (req, res, next) {
  res.header('Access-Control-Allow-Origin', 'http://127.0.0.1:5500');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  res.header('Access-Control-Allow-Headers', 'Content-Type');
  next();
});

// Route to handle the CORS request
app.get('/api/data', (req, res) => {
  const data = { message: 'GET from server' };
  res.json(data);
});

const port = 3000;
app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`);
});
```

```html
<body>
  <button onclick="getData()">Get Data from Server</button>
  <p id="result"></p>

  <script>
    function getData() {
      const url = 'http://localhost:3000/api/data';

      fetch(url)
        .then((response) => response.json())
        .then((data) => {
          document.getElementById('result').innerText = data.message;
        })
        .catch((error) => {
          console.error('Error fetching data:', error);
        });
    }
  </script>
</body>
```

캐시 켜놔서 안됐었음 ㅋㅋ ㅠ
